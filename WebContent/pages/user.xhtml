<ui:composition template="base.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:p="http://primefaces.org/ui">
	
	<ui:define name="headContent">
		<h:outputStylesheet library="css" name="user.css" />
	</ui:define>

	<ui:define name="content">
	
	<c:if test="${param['rendered'] != null}">
		#{ userBean.setRendered(param['rendered'])}
	</c:if>

	<c:set var="user" value="#{userBean.user}" />

		<div> 
	        <div class="container" style="margin-bottom: 50px;margin-top:20px;">
	            <div class="row">
	                <div class="col-sm-12 col-md-12 col-lg-4 col-xl-4" style="padding: 0px 0px 30px 0px;">
	                    <div id="user-menu" style="padding: 30px;margin-right: 0;">
	                        <div class="image-container">
	                        	<c:if test="${not empty user.imagePath}">
	                        		<h:graphicImage class="img-fluid" a:loading="lazy" a:alt="user_image" value="/resources/files/#{user.imagePath}"/>
                        		</c:if>
                        		<c:if test="${empty user.imagePath}">
                        			<center>
                        				<i class="fa fa-user-circle-o" style="color: white; font-size: 200px;"/>
                     				</center>
                        		</c:if>
	                       	</div>
	                        <ul class="list-group" style="margin-top: 20px;">
	                            <li class="list-group-item">
	                            	<h:form>
	                            		<center>
		                            		<h:commandLink class="link" value="Definitions" action="#{ userBean.setRendered('definitions')}"/>
		                            	</center>	
	                            	</h:form>
	                            </li>
	                             <li class="list-group-item">
	                            	<h:form>
	                            		<center>
		                            		<h:commandLink class="link" value="Events" action="#{ userBean.setRendered('events')}"/>
	                            		</center>
	                            	</h:form>
	                            </li>
	                             <li class="list-group-item">
	                            	<h:form>
	                            		<center>
		                            		<h:commandLink class="link" value="Projects" action="#{ userBean.setRendered('projects')}"/>
		                            	</center>	
	                            	</h:form>
	                            </li>
	                             <li class="list-group-item">
	                            	<h:form>
		                            	<center>
		                            		<h:commandLink class="link" value="Research" action="#{ userBean.setRendered('research')}"/>
	                            		</center>
	                            	</h:form>
	                            </li>
	                             <li class="list-group-item">
	                            	<a class="link">Applications</a>
	                            </li>
	                        </ul>
	                        <h:form>
	                            <h:link class="btn btn-primary" style="margin-top:10px;width:100%" outcome="becameMember">
	                        		<i class="fa fa-plus"></i> Become a member
	                       	   </h:link>
                       	   </h:form>
	                    </div>
	                </div>
	                
	                <div class="col-sm-12 col-md-12 col-lg-8 col-xl-8">
	                
	                <h:panelGroup id="definitions" >
	                	<h:panelGroup rendered="#{ userBean.rendered == 'definitions'}">
		                    <div class="content  def" style="padding: 30px;">
			                        <h1 class="display-4 text-center" style="margin-bottom: 30px;">Definitions</h1>
			                        
			                        <h:outputText value="#{userBean.definitionsErrorMessage}" class="error-label-md" style="margin-bottom:10px"/>
			                       
			                        <h:form>
			                            <div class="form-group">
			                                <div class="form-row">
			                                    <div class="col-md-2 col-lg-2 col-xl-2">
			                                    	<label class="col-form-label">Email</label>
		                                    	</div>
			                                    <div class="col-md-10 col-lg-10 col-xl-10">
			                                    
			                                    	<h:inputText class="form-control" a:type="email" a:placeholder="#{user.email}" value="#{userBean.email}" 
			                                    	validatorMessage="Invalid email" id="email"  a:maxlength="70" a:minlength="6">
														<f:validateRegex pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$"/>		
													</h:inputText>
													
													<h:message for="email" class="error-label-sm" />
		                                    	</div>
			                                </div>
			                            </div>
			                            <div class="form-group">
			                                <div class="form-row">
			                                    <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6">
			                                        <div class="form-row">
			                                            <div class="col-md-3 col-lg-4 col-xl-4">
			                                            	<label class="col-form-label">First Name</label>
		                                            	</div>
			                                            <div class="col-md-9 col-lg-8 col-xl-8">
			                                            	<h:inputText class="form-control" a:placeholder="#{user.firstName}" value="#{userBean.firstName}"
			                                            	 validatorMessage="Frist name must have only letters" id="fristName">
																<f:validateRegex pattern="[a-zA-Z]*"/>
															</h:inputText>
															<h:message for="fristName" class="error-label-sm" />
		                                            	</div>
			                                        </div>
			                                    </div>
			                                    <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6">
			                                        <div class="form-row">
			                                            <div class="col-md-3 col-lg-4 col-xl-4">
			                                            	<label class="col-form-label">Last Name<br/></label>
		                                            	</div>
			                                            <div class="col-md-9 col-lg-8 col-xl-8">
			                                            	<h:inputText class="form-control" a:placeholder="#{user.lastName}" value="#{userBean.lastName}"
			                                            	validatorMessage="last name must have only letters" id="lastName">
																<f:validateRegex pattern="[a-zA-Z]*"/>
															</h:inputText>
															
															<h:message for="lastName" class="error-label-sm" />
		                                            	</div>
			                                        </div>
			                                    </div>
			                                </div>
			                            </div>
			                            <div class="form-group">
			                                <div class="form-row">
			                                    <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6">
			                                        <div class="form-row">
			                                            <div class="col-md-3 col-lg-4 col-xl-4">
			                                            	<label class="col-form-label">Cell Phone</label>
		                                            	</div>
			                                            <div class="col-md-9 col-lg-8 col-xl-8">
			                                            
			                                            	<h:inputText class="form-control" a:type="tel" a:placeholder="#{user.cellPhone}" value="#{userBean.cellPhone}"
											                 validatorMessage="cell phone must have only 9 numbers" id="cellPhone" a:maxlength="9" a:minlength="9">
																<f:validateRegex pattern="[0-9]{9}"/>
															</h:inputText>
															
															<h:message for="cellPhone" class="error-label-sm" />
															
			                                            </div>
			                                        </div>
			                                    </div>
			                                    <div class="col-lg-6 col-xl-6">
			                                        <div class="form-row">
			                                            <div class="col-md-3 col-lg-4 col-xl-4">
			                                            	<label class="col-form-label">Course<br/></label>
		                                            	</div>
			                                            <div class="col-md-9 col-lg-8 col-xl-8">
			                                            	<h:inputText class="form-control" a:placeholder="#{user.course}" value="#{userBean.course}"/>
		                                            	</div>
			                                        </div>
			                                    </div>
			                                </div>
			                            </div>
			                            <div class="form-group">
			                                <div class="form-row">
			                                    <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6">
			                                        <div class="form-row">
			                                            <div class="col-md-3 col-lg-4 col-xl-4">
			                                            	<label class="col-form-label">Username</label>
		                                            	</div>
			                                            <div class="col-md-9 col-lg-8 col-xl-8">
			                                            	<h:inputText class="form-control" a:placeholder="#{user.username}" value="#{userBean.username}"
															validatorMessage="Invalid username" id="username"  a:maxlength="60" a:minlength="6">
															<f:validateRegex pattern="[a-zA-Z0-9]{4,}"/>		
														</h:inputText>
														
														<h:message for="username" class="error-label-sm" />
		                                            	</div>
			                                        </div>
			                                    </div>
			                                    <div class="col-sm-12 col-md-12 col-lg-6 col-xl-6">
			                                        <div class="form-row">
			                                            <div class="col-md-3 col-lg-4 col-xl-4">
			                                            	<label class="col-form-label">Password<br/></label>
		                                            	</div>
			                                            <div class="col-md-9 col-lg-8 col-xl-8">
			                                            	<h:inputSecret class="form-control" a:placeholder="New password" value="#{userBean.newPassword}"
			                                            	validatorMessage="Password must be between 8 and 64 characters long" id="newPassword">
			                                            		<f:validateRegex pattern=".{8,64}"/>	
			                                           		 </h:inputSecret>	
		                                            	</div>
		                                            	<h:message for="newPassword" class="error-label-sm" />
			                                        </div>
			                                    </div>
			                                </div>
			                            </div>
			                            <div class="form-group">
			                                <div class="form-row">
			                                    <div class="col-sm-12">
			                                        <div class="form-row">
			                                            <div class="col-sm-3 col-md-3 col-lg-2 col-xl-2">
			                                            	<h:commandButton class="btn btn-primary" value="Save" update="@form" action="#{userBean.saveChanges()}"/>
		                                            	</div>
			                                            <div class="col-sm-9 col-md-9 col-lg-4 col-xl-4">
			                                            	<h:inputSecret id="password" class="form-control" a:placeholder="Password" value="#{userBean.password}" required="true" 
			                                            	requiredMessage="Password is required to save changes"/>
			                                            	 <h:message for="password" class="error-label-sm" />
		                                            	</div>
			                                        </div>
			                                    </div>
			                                </div>
			                               
			                            </div>
			                        </h:form>
			                      
			                  	</div>
		               	</h:panelGroup>
	               	</h:panelGroup>
	               	
	               	<h:panelGroup id="events" >
	         			<h:panelGroup rendered="#{ userBean.rendered == 'events'}">
		                    <div class="content">
		                        <h1 class="display-4 text-center" style="margin-bottom: 30px;">Events</h1>
		                        
		                        <div role="tablist" id="accordion-1">
		                        	
		                        	<c:forEach items="#{user.getEvents()}" var="event" varStatus="loopStatus">
		                        	
		                        		<div class="card">
		                        		
			                                <div class="card-header" role="tab">
			                                    <h5 class="mb-0">
			                                    	<a data-toggle="collapse" aria-expanded="true" aria-controls="accordion-1 .item-#{loopStatus.index + 1}" href="#accordion-1 .item-#{loopStatus.index + 1}">#{event.title}</a>
			                                    </h5>
			                                </div>
			                                
			                                <div class="collapse #{(loopStatus.index + 1) == 1 ? 'show ' : ''}item-#{loopStatus.index + 1}" role="tabpanel" data-parent="#accordion-1">
			                                
			                                    <div class="card-body">
			                                    
				                                    <c:forEach items="#{event.infos}" var="info" varStatus="loopStatus1">
				                      
														<div>
				                                            <ul class="list-inline">
				                                                <li class="list-inline-item"><i class="fa fa-map-marker"></i> #{info.getPlace()}</li>
				                                                <li class="list-inline-item"><i class="fa fa-calendar"></i> #{info.getStartDateDay()} #{info.getStartDateMonth()}</li>
				                                                <li class="list-inline-item"><i class="fa fa-clock-o"></i>#{info.getStartDateHours()} - #{info.getEndDateHours()}</li>
				                                            </ul>
			                                               <h:form>
									                            <h:button class="btn btn-primary rect-border" a:data-bs-hover-animate="pulse" value="See event" outcome="event">
									                      	      	<f:param name="id" value="#{event.getId()}" />
									                            </h:button>
								                           </h:form>
			                                            </div>
							                        
						                            </c:forEach>
			                                        
			                                    </div>
			                                </div>
			                            </div>
               			              	
		                      		</c:forEach> 
		                      		
		                      		<c:if test="#{empty user.getEvents()}">
		                      			<h2 class="text-center" contenteditable="true">You don't have any events joined, try to create or dicover one!!!<br/><br/></h2>
		                      		</c:if>
		                      		
		                             <div class="row text-center" style="margin-top: 30px;">
									    <div class="col">
									    	<h:link class="btn btn-primary"  outcome="createEvent"> <i class="fa fa-plus"></i> Create Event</h:link>
								    	</div>
									    <div class="col">
									    	<h:link class="btn btn-primary"  outcome="events"><i class="fa fa-search"></i> Discover Events</h:link>
									    </div>
									</div>
									
		                        </div>
		                    </div>
	               		</h:panelGroup>
	               	</h:panelGroup>
	               	
	      	     	<h:panelGroup id="projects" >
	         			<h:panelGroup rendered="#{ userBean.rendered == 'projects'}">
								
								<div class="content"> <!-- Joined Projects -->
								   <div style="margin-top: 10px;">
				                        <h1 class="display-4 text-center" style="margin-bottom: 30px;">Joined Projects</h1>
				                        <h:panelGroup class="table-responsive" rendered="#{not empty user.joinedProjects}">
				                        
				                        	<h:dataTable class="table table-hover" value="#{user.joinedProjects}" var="p" >
				                        		<h:column>
				                        			<f:facet name="header">Project title</f:facet>

				                        			<h:link class="text-dark" a:data-toggle="modal" a:data-target="#project-modal" value="#{p.title}"/>
				                        			
				                        			<div class="modal fade" role="dialog" tabindex="-1" id="project-modal">
												        <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
												            <div class="modal-content">
												                <div class="modal-header">
												                <h4 class="display-4 modal-title">#{p.title}</h4><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>
												                <div class="modal-body">
												                    <h4>Description</h4>
												                    <p><br/>#{p.description}<br/><br/></p>
												                    <h4>Requirements</h4>
												                    <p><br/>#{p.requirements}<br/><br/></p>
												                    <h4>Dates</h4>
												                    <br/>
												                    <p>Dead line : #{p.deadLine.toString().substring(0,16)}</p>
												                    <p>Candidature dead line : #{p.subscriptionDeadline.toString().substring(0,16)}</p>
												                    <div class="text-center">
											                    	    <h:form>
													                        <h:button class="btn btn-primary" value="Discover" outcome="project">
													                        	<f:param name="projectID" value="#{p.id}" />
													                        </h:button>
												                        </h:form>
												                        <br/>
												                	</div>
												                	<div class="modal-footer">
												                		<button class="btn btn-light" type="button" data-dismiss="modal">Close</button>
												                		<!-- <button class="btn btn-primary" type="button">Save</button> -->
											                		</div>
										                		</div>
												            </div>
												        </div>
												    </div>
												    
			                        			</h:column>
				                        		<h:column>
				                        			<f:facet name="header">Date</f:facet>
				                        			#{p.deadLine.toString().substring(0,16)}
			                        			</h:column>
				                        		<h:column>
				                        			<f:facet name="header">Edit</f:facet>
				                        			<i class="fa fa-remove"/>
				                        		</h:column>
				                        	</h:dataTable>
				                        </h:panelGroup>
				                    </div>


									<c:if test="#{empty user.joinedProjects}">
		                      			<h2 class="text-center" contenteditable="true">You don't have any projects joined, try to create or discover one!!!<br/></h2>
		                      		</c:if>
		                      		
		                             <div class="row text-center" style="margin-top: 30px;">
									    <div class="col">
									    	<h:link class="btn btn-primary" outcome="createProject"> <i class="fa fa-plus"></i> Create Project</h:link>
								    	</div>
									    <div class="col">
									    	<h:link class="btn btn-primary"  outcome="projects"><i class="fa fa-search"></i> Discover Projects</h:link>
									    </div>
									</div>
								</div>	

								<div class="content " style="margin-top: 10px;"><!-- Liked Projects -->
				                        <h1 class="display-4 text-center" style="margin-bottom: 30px;">Liked Projects</h1>
				                        <h:panelGroup id="likes-table" class="table-responsive" rendered="#{not empty user.likedProjects}">
				                        
				                        	<h:dataTable class="table table-hover" value="#{user.likedProjects}" var="p" >
				                        		<h:column>
			                        				<f:facet name="header">
				                        				<div style="text-align:center">
				                        					Project title
		                        						</div>
		                        					</f:facet>
													<div style="text-align:center">
				                        				<h:link class="text-dark" a:data-toggle="modal" a:data-target="#project-modal" value="#{p.title}"/>
													</div>
																	                        			
				                        			<div class="modal fade" role="dialog" tabindex="-1" id="project-modal">
												        <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
												            <div class="modal-content">
												                <div class="modal-header">
												                <h4 class="display-4 modal-title">#{p.title}</h4><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>
												                <div class="modal-body">
												                    <h4>Description</h4>
												                    <p><br/>#{p.description}<br/><br/></p>
												                    <h4>Requirements</h4>
												                    <p><br/>#{p.requirements}<br/><br/></p>
												                    <h4>Dates</h4>
												                    <br/>
												                    <p>Dead line : #{p.deadLine.toString().substring(0,16)}</p>
												                    <p>Candidature dead line : #{p.subscriptionDeadline.toString().substring(0,16)}</p>
												                    <div class="text-center">
											                    	    <h:form>
													                        <h:button class="btn btn-primary" value="Discover" outcome="project">
													                        	<f:param name="projectID" value="#{p.id}" />
													                        </h:button>
												                        </h:form>
												                        <br/>
												                	</div>
												                	<div class="modal-footer">
												                		<button class="btn btn-light" type="button" data-dismiss="modal">Close</button>
												                		<!-- <button class="btn btn-primary" type="button">Save</button> -->
											                		</div>
										                		</div>
												            </div>
												        </div>
												    </div>
			                        			</h:column>
				                        		<h:column>
				                        			<f:facet name="header">
				                        				<div style="text-align:center">
				                        					Date
		                        						</div>
		                        					</f:facet>
		                        					<div style="text-align:center">
				                        				#{p.deadLine.toString().substring(0,16)}
				                        			</div>
			                        			</h:column>
				                        		<h:column >
				                        			<f:facet name="header">
				                        				<div style="text-align:center">
				                        					Dislike
		                        						</div>
		                        					</f:facet>
				                        			<div style="text-align:center">
				                        				<h:form>
				                        					<h:commandLink  actionListener="#{userBean.dislikeProject}">
				                        						<f:attribute name="projectId" value="#{p.id}"/>
				                        						<f:ajax render="@all" execute="@this"/>
				                        						<i class="fa fa-thumbs-down hover-red"/>
				                        					</h:commandLink>
				                        				</h:form>
				                        				
				                        			</div>
				                        		</h:column>
				                        	</h:dataTable>
				                        </h:panelGroup>

										<c:if test="#{empty user.likedProjects}">
			                      			<h2 class="text-center" contenteditable="true">You didn't liked any project <i class="fa fa-frown-o"/></h2>
			                      			<h2 class="text-center" contenteditable="true">Try to discover one!!!<br/></h2>
		                      		
		                      				<div style="text-align:center;margin-top:40px">
		                      					<h:link class="btn btn-primary"  outcome="projects"><i class="fa fa-search"></i> Discover Projects</h:link>
		                      				</div>
										</c:if>
									</div>
	               		</h:panelGroup>
	               	</h:panelGroup>
	               	
	      	     	<h:panelGroup id="research" >
	         			<h:panelGroup rendered="#{ userBean.rendered == 'research'}">
		                    <div class="content">
		                        <h1 class="display-4 text-center" style="margin-bottom: 30px;">Research</h1>
		                        <div role="tablist" id="accordion-1">
		                            <div class="card">
		                                <div class="card-header" role="tab">
		                                    <h5 class="mb-0"><a data-toggle="collapse" aria-expanded="true" aria-controls="accordion-1 .item-1" href="#accordion-1 .item-1">Event title</a></h5>
		                                </div>
		                                <div class="collapse show item-1" role="tabpanel" data-parent="#accordion-1">
		                                    <div class="card-body">
		                                        <div>
		                                            <ul class="list-inline">
		                                                <li class="list-inline-item"><i class="fa fa-map-marker"></i> Avenida das forças armadas (ISCTE-IUL)</li>
		                                                <li class="list-inline-item"><i class="fa fa-calendar"></i> 03/07/2020</li>
		                                                <li class="list-inline-item"><i class="fa fa-clock-o"></i> 20: 30 - 00:30</li>
		                                            </ul><button class="btn btn-primary" type="button">See event</button></div>
		                                    </div>
		                                </div>
		                            </div>
		                            <div class="card">
		                                <div class="card-header" role="tab">
		                                    <h5 class="mb-0"><a data-toggle="collapse" aria-expanded="false" aria-controls="accordion-1 .item-2" href="#accordion-1 .item-2">Accordion Item</a></h5>
		                                </div>
		                                <div class="collapse item-2" role="tabpanel" data-parent="#accordion-1">
		                                    <div class="card-body">
		                                        <p class="card-text">Nullam id dolor id nibh ultricies vehicula ut id elit. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus.</p>
		                                    </div>
		                                </div>
		                            </div>
		                            <div class="card">
		                                <div class="card-header" role="tab">
		                                    <h5 class="mb-0"><a data-toggle="collapse" aria-expanded="false" aria-controls="accordion-1 .item-3" href="#accordion-1 .item-3">Accordion Item</a></h5>
		                                </div>
		                                <div class="collapse item-3" role="tabpanel" data-parent="#accordion-1">
		                                    <div class="card-body">
		                                        <p class="card-text">Nullam id dolor id nibh ultricies vehicula ut id elit. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus.</p>
		                                    </div>
		                                </div>
		                            </div>
		                        </div>
		                    </div>
	               		</h:panelGroup>
	               	</h:panelGroup>
	               	
	                </div>
	            </div>
	        </div>
	    </div>
	</ui:define>
</ui:composition>