<ui:composition template="adminBase.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="content">
	
	
		<div class="d-sm-flex justify-content-between align-items-center mb-4">
                <h3 class="text-dark mb-0">Researches</h3>
                </div>
                <div class="row">
                    <div class="col-md-6 col-xl-3 mb-4">
                        <div class="card shadow border-left-primary py-2">
                            <div class="card-body">
                                <div class="row align-items-center no-gutters">
                                    <div class="col mr-2">
                                        <div class="text-uppercase text-primary font-weight-bold text-xs mb-1"><span>views  (per month)</span></div>
                                        <div class="text-dark font-weight-bold h5 mb-0"><span>#{adminResearchesBean.viewsMonth}</span></div>
                                    </div>
                                    <div class="col-auto"><i class="far fa-eye fa-2x text-gray-300"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                       <div class="col-md-6 col-xl-3 mb-4">
                        <div class="card shadow border-left-info py-2">
                            <div class="card-body">
                                <div class="row align-items-center no-gutters">
                                    <div class="col mr-2">
                                        <div class="text-uppercase text-info font-weight-bold text-xs mb-1"><span>likes (per month)</span></div>
                                        <div class="text-dark font-weight-bold h5 mb-0"><span>#{adminResearchesBean.likesMonth}</span></div>
                                    </div>
                                    <div class="col-auto"><i class="fas fa-clipboard-list fa-2x text-gray-300"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-xl-3 mb-4">
                        <div class="card shadow border-left-success py-2">
                            <div class="card-body">
                                <div class="row align-items-center no-gutters">
                                    <div class="col mr-2">
                                        <div class="text-uppercase text-success font-weight-bold text-xs mb-1"><span>Researches developing</span></div>
                                        <div class="text-dark font-weight-bold h5 mb-0"><span>#{adminResearchesBean.researchesDeveloping}</span></div>
                                    </div>
                                    <div class="col-auto"><i class="fas fa-dollar-sign fa-2x text-gray-300"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-xl-3 mb-4">
                        <div class="card shadow border-left-warning py-2">
                            <div class="card-body">
                                <div class="row align-items-center no-gutters">
                                    <div class="col mr-2">
                                        <div class="text-uppercase text-warning font-weight-bold text-xs mb-1"><span>Pending researches </span></div>
                                        <div class="text-dark font-weight-bold h5 mb-0"><span>#{adminResearchesBean.pendingResearches}</span></div>
                                    </div>
                                    <div class="col-auto"><i class="fas fa-comments fa-2x text-gray-300"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 30px;">
                    <div class="card shadow py-2" style="margin: 0 auto;">
                        <div class="card-body">
                        	 <div class="row">
							    <div class="col-6">
							        <canvas id="barChartCreatedResearches"/>
							    </div>
							    <div class="col-6">
							        <canvas id="lineChartViews"/>
							    </div>
							</div>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 30px;">
                    <div class="card shadow py-2">
                        <div class="card-body ">
                            <h1 class="display-3 text-center">Researches</h1>
	                            <h:dataTable class="table table-hover text-center" value="#{adminResearchesBean.researches}" var="r" id="table">
	                            	<h:column>
	                            		<f:facet name="header">#Id</f:facet>
	                            		#{r.id}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Title</f:facet>
	                            		#{r.title}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">State</f:facet>
	                            		#{r.state}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Type</f:facet>
	                            		#{r.type}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Investigators</f:facet>
	                            		<ui:repeat var="investigator" value="#{r.investigators}">
	                            			#{investigator.user.username} 
	                            		</ui:repeat>
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Views</f:facet>
	                            		#{r.views}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Likes</f:facet>
	                            		#{r.likes}
	                            	</h:column>
	                            	<h:column>
	                            		<f:facet name="header">Edit</f:facet>
	                            		<h:form>
		                            		<h:commandLink class="link">
					                        	<f:attribute name="projectId" value="#{r.id}"/>
					                        	<f:ajax render=":table" execute="@this"/>
					                        	<i class="fa fa-remove"/>
					                        </h:commandLink>
	                           		    <h:link class="link" >
				                        	<f:param name="projectId" value="#{r.id}" />
				                        	<i class="fa fa-eye"/>
				                        </h:link>
				                        </h:form>
	                            	</h:column>
	                            </h:dataTable>
                        </div>
                    </div>
                </div>
	</ui:define>
	
	<ui:define name="scripts">
		<script>
			$('.table').DataTable();
		</script>
				<!-- charts -->
		<!-- lineChart -->
		<script>
			var ctxL = document.getElementById("lineChartViews").getContext('2d');
// 		    var gradientFill = ctxL.createLinearGradient(0, 0, 0, 290);
// 		    gradientFill.addColorStop(0, "rgba(78,115,223, 1)");
// 		    gradientFill.addColorStop(1, "rgba(78,115,223, 0.1)");
		    var myLineChart = new Chart(ctxL, {
		      type: 'line',
		      data: {
		        labels: [<c:forEach items="#{adminResearchesBean.getLastMonths()}" var="m"> "#{m}", </c:forEach>],
		        datasets: [
		          {
		            label: "Researches views",
		            data: [<c:forEach items="#{adminResearchesBean.getLastMonthsViews()}" var="d"> #{d}, </c:forEach>],
		            //backgroundColor: gradientFill,
		            backgroundColor: [ 'rgba(246,248,253, 0.2)', ],
		            borderColor: [ '#4e73df', ],
		            borderWidth: 2,
		            pointBorderColor: "#4e73df", 
		            pointBackgroundColor: "rgba(78,115,223, 0.5)",
		          },
		          {
		            label: "Likes",
		            data: [<c:forEach items="#{adminResearchesBean.getLastMonthsLikes()}" var="d"> #{d}, </c:forEach>],
		            backgroundColor: [ 'rgb(255,230,230,0.5)', ],
		            borderColor: [ 'rgba(255, 179, 179,1)', ],
		            borderWidth: 2,
		            pointBorderColor: "rgba(255, 179, 179,0.5)", 
		            pointBackgroundColor: "rgb(255,230,230,0.5)",
		          }
		        ]
		      },
		      options: {
		        responsive: true
		      }
		    });
	    </script>
	    
		<!-- Bar chart -->
	    <script>
			var ctxL = document.getElementById("barChartCreatedResearches").getContext('2d');
		    var gradientFill = ctxL.createLinearGradient(0, 0, 0, 290);
		    gradientFill.addColorStop(0, "rgba(78,115,223, 1)");
		    gradientFill.addColorStop(1, "rgba(78,115,223, 0.3)");
		    var myLineChart = new Chart(ctxL, {
		      type: 'bar',
		      data: {
		        labels: [ <c:forEach items="#{adminResearchesBean.getLastMonths()}" var="m"> "#{m}", </c:forEach> ],
		        datasets: [
		          {
		            label: "Researches created",
		            data: [<c:forEach items="#{adminResearchesBean.getLastMonthsResearchesCreated()}" var="d"> #{d}, </c:forEach>],
		            backgroundColor: gradientFill,
		            borderColor: [ 'rgb(78,115,223)', ],
		            borderWidth: 2,
		            pointBorderColor: "#fff",
		            pointBackgroundColor: "rgba(78,115,223, 0.1)",
		          }
		        ]
		      },
		      options: {
		        responsive: true
		      }
		    });
	    </script>
	</ui:define>
</ui:composition>